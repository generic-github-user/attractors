---

title: attractor


keywords: fastai
sidebar: home_sidebar



nb_path: "00_attractor.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_attractor.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">fixed</span><span class="p">,</span> <span class="n">interact_manual</span><span class="p">,</span> <span class="n">Layout</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># todo: chaos analysis</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Attractor" class="doc_header"><code>class</code> <code>Attractor</code><a href="https://github.com/generic-github-user/attractors/tree/main/attractors/core.py#L22" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Attractor</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="IteratedFunctionSystem" class="doc_header"><code>class</code> <code>IteratedFunctionSystem</code><a href="https://github.com/generic-github-user/attractors/tree/main/attractors/core.py#L28" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>IteratedFunctionSystem</code>() :: <a href="/attractors/attractor.html#Attractor"><code>Attractor</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="rotation_matrix" class="doc_header"><code>rotation_matrix</code><a href="https://github.com/generic-github-user/attractors/tree/main/attractors/core.py#L34" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>rotation_matrix</code>(<strong><code>a</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="rotate" class="doc_header"><code>rotate</code><a href="https://github.com/generic-github-user/attractors/tree/main/attractors/core.py#L46" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>rotate</code>(<strong><code>a</code></strong>, <strong><code>b</code></strong>, <strong><code>t</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="simulate_accelerated" class="doc_header"><code>simulate_accelerated</code><a href="https://github.com/generic-github-user/attractors/tree/main/attractors/core.py#L57" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>simulate_accelerated</code>(<strong><code>speeds</code></strong>, <strong><code>pivots</code></strong>, <strong><code>center</code></strong>, <strong><code>angles</code></strong>, <strong><code>start</code></strong>, <strong><code>points</code></strong>, <strong><code>steps</code></strong>=<em><code>100</code></em>, <strong><code>clip</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Efficiently simulate a system of rotating segments joined by pivots using Numba to JIT-compile operations on NumPy arrays.</p>
<ul>
<li><code>steps</code>: integer &gt;=1; the number of timesteps to simulate</li>
<li><code>clip</code>: <code>boolean</code>; whether to limit the maximum angle of each section (if <code>True</code>, the values will wrap around to 0; defaults to <code>True</code>)</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">doc</span><span class="p">(</span><span class="n">simulate_accelerated</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<h4 id="simulate_accelerated" class="doc_header"><code>simulate_accelerated</code><a href="__main__.py#L3" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>simulate_accelerated</code>(<strong><code>speeds</code></strong>, <strong><code>pivots</code></strong>, <strong><code>center</code></strong>, <strong><code>angles</code></strong>, <strong><code>start</code></strong>, <strong><code>points</code></strong>, <strong><code>steps</code></strong>=<em><code>100</code></em>, <strong><code>clip</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Efficiently simulate a system of rotating segments joined by pivots using Numba to JIT-compile operations on NumPy arrays.</p>
<ul>
<li><code>steps</code>: integer &gt;=1; the number of timesteps to simulate</li>
<li><code>clip</code>: <code>boolean</code>; whether to limit the maximum angle of each section (if <code>True</code>, the values will wrap around to 0; defaults to <code>True</code>)</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="line" class="doc_header"><code>line</code><a href="https://github.com/generic-github-user/attractors/tree/main/attractors/core.py#L98" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>line</code>(<strong><code>start</code></strong>, <strong><code>stop</code></strong>, <strong><code>bg</code></strong>, <strong><code>width</code></strong>=<em><code>1.0</code></em>, <strong><code>quality</code></strong>=<em><code>5.0</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">im</span> <span class="o">=</span> <span class="n">line</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">]),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">40.</span><span class="p">,</span> <span class="mf">40.</span><span class="p">]),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)),</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="c1"># print(im.max())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="RouletteCurve" class="doc_header"><code>class</code> <code>RouletteCurve</code><a href="https://github.com/generic-github-user/attractors/tree/main/attractors/core.py#L123" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>RouletteCurve</code>(<strong><code>center</code></strong>=<em><code>[0, 0]</code></em>, <strong><code>num_sections</code></strong>=<em><code>4</code></em>, <strong><code>lengths</code></strong>=<em><code>None</code></em>, <strong><code>speeds</code></strong>=<em><code>None</code></em>, <strong><code>random_distribution</code></strong>=<em><code>'uniform'</code></em>) :: <a href="/attractors/attractor.html#Attractor"><code>Attractor</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Colormap</span><span class="p">(</span><span class="s1">&#39;cool&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.colors.Colormap at 0x23dba31bd60&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">RouletteCurve</span><span class="p">(</span><span class="n">num_sections</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
<span class="c1"># R = RouletteCurve(lengths=[10]*m, speeds=[1]*m)</span>
<span class="c1"># print(R.pivots, R.points)</span>
<span class="c1"># print(R.start, R.lengths)</span>
<span class="c1"># R.simulate(live_rendering=False, duration=5).render(mode=&#39;hist&#39;, blending=&#39;add&#39;, hist_args=dict(bins=100)</span>
<span class="c1">#                           cmap=random.choice(plt.colormaps())</span>
<span class="c1">#                          )</span>
<span class="c1"># todo: estimate completion time</span>
<span class="c1"># print(R.start, R.lengths)</span>

<span class="n">R</span><span class="o">.</span><span class="n">simulate_accelerated</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">blending</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">point_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hist_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">150</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">pivots</span><span class="p">,</span> <span class="n">R</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[[ 0.         -1.09736288]
 [-0.06505168  1.22416644]] [0. 0.]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">doc</span><span class="p">(</span><span class="n">RouletteCurve</span><span class="o">.</span><span class="n">render</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<h4 id="RouletteCurve.render" class="doc_header"><code>RouletteCurve.render</code><a href="__main__.py#L207" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>RouletteCurve.render</code>(<strong><code>discard</code></strong>=<em><code>False</code></em>, <strong><code>clip</code></strong>=<em><code>False</code></em>, <strong><code>axis</code></strong>=<em><code>None</code></em>, <strong><code>recenter</code></strong>=<em><code>True</code></em>, <strong><code>zoom</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'line'</code></em>, <strong><code>blending</code></strong>=<em><code>'add'</code></em>, <strong><code>hist_args</code></strong>=<em><code>{}</code></em>, <strong><code>cmap</code></strong>=<em><code>'random'</code></em>, <strong><code>point_value</code></strong>=<em><code>1</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Render an image from the list of points stored in the class instance.</p>
<ul>
<li><code>discard</code>: <code>boolean</code>; if <code>True</code>, clear this <a href="/attractors/attractor.html#Attractor"><code>Attractor</code></a>'s points after rendering to free up memory</li>
<li><code>axis</code>: A Matplotlib axis to render the finished image to (if one is not provided, it will be created)</li>
<li><code>zoom</code>: A scaling factor by which to resize points relative to the <code>center</code> before rendering</li>
<li><code>mode</code>: <code>str</code>, one of <code>pixel</code>, <code>dist</code>/<code>brush</code>, <code>line</code>, or <code>hist</code><ul>
<li><code>pixel</code>: Convert each point coordinate to the (integer) coordinate of the nearest pixel</li>
<li><code>dist</code>: Generate a "brush" based on a distance function relative to the point coordinates, then (for each point) paint this over a region of the canvas centered on that point</li>
<li><code>line</code>: Draw a line from the last rendered point to the current one (helpful for reducing the total number of points that must be rendered)</li>
<li><code>hist</code>: Generate a 2D histogram using NumPy and display this (similar to <code>pixel</code>)</li>
</ul>
</li>
<li><code>blending</code>: <code>str</code>, one of <code>set</code>, <code>add</code>, or <code>mul</code>; how the new pixel value (while rendering a point) should be combined with the current one</li>
<li><code>cmap</code>: <code>random</code> or a Matplotlib colormap; the colormap to pass to <code>imshow</code> - if <code>random</code>, one will be selected from the sequential colormaps listed in <code>RouletteCurve().cmaps</code></li>
<li><code>point_value</code></li>
<li><code>**kwargs</code></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([0.5, 1. ])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">R2</span> <span class="o">=</span> <span class="n">RouletteCurve</span><span class="p">(</span><span class="n">num_sections</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">simulate_accelerated</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">R2</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">,</span> <span class="n">blending</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">point_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hist_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">200</span><span class="p">))</span>
<span class="c1"># why is this so fast?</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R2</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>255255
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="mi">1</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([1, 1, 1], dtype=int32)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="n">continuous_update</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">checkbox</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Continuous&#39;</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">()}</span>
<span class="n">seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="n">layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;500px&#39;</span><span class="p">)</span>
<span class="n">slider_settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">continuous_update</span><span class="o">=</span><span class="n">continuous_update</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>
<span class="n">speeds</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span>
              <span class="nb">min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> 
              <span class="nb">max</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span> 
              <span class="n">step</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> 
              <span class="n">value</span> <span class="o">=</span> <span class="n">seed</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">**</span><span class="n">slider_settings</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">)}</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>
<span class="n">quality</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Quality&#39;</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">continuous_update</span><span class="o">=</span><span class="n">continuous_update</span><span class="p">)}</span>
<span class="c1"># widgets.FloatLogSlider</span>
<span class="n">quality</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Points&#39;</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatLogSlider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">**</span><span class="n">slider_settings</span><span class="p">)}</span>
<span class="n">resolution</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Resolution&#39;</span><span class="p">:</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">slider_settings</span><span class="p">)}</span>
<span class="n">interact_options</span> <span class="o">=</span> <span class="n">speeds</span> <span class="o">|</span> <span class="n">quality</span> <span class="o">|</span> <span class="n">checkbox</span> <span class="o">|</span> <span class="n">resolution</span>
<span class="nd">@interact</span><span class="p">(</span><span class="o">**</span><span class="n">interact_options</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="n">R</span><span class="o">.</span><span class="n">cmaps</span><span class="p">,</span> <span class="o">**</span><span class="n">interact_options</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="p">[</span><span class="n">quality</span><span class="p">]:</span>
        <span class="n">widget</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">continuous_update</span> <span class="o">=</span> <span class="n">interact_options</span><span class="p">[</span><span class="s1">&#39;Continuous&#39;</span><span class="p">]</span>
    
<span class="c1">#     global speeds</span>
    <span class="n">speeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">interact_options</span><span class="o">.</span><span class="n">values</span><span class="p">())[:</span><span class="n">x</span><span class="p">])</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">RouletteCurve</span><span class="p">(</span><span class="n">lengths</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">speeds</span><span class="o">=</span><span class="n">speeds</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="c1">#     cmap=&#39;Blues&#39;</span>
    <span class="n">render_options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">,</span> <span class="n">blending</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">hist_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="n">interact_options</span><span class="p">[</span><span class="s1">&#39;Resolution&#39;</span><span class="p">]),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="c1">#     R.simulate(live_rendering=False, duration=interact_options[&#39;Quality&#39;], render_each=2000, render_settings=render_options)</span>

    <span class="n">R</span><span class="o">.</span><span class="n">simulate_accelerated</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">interact_options</span><span class="p">[</span><span class="s1">&#39;Points&#39;</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="n">R</span><span class="o">.</span><span class="n">speeds</span><span class="p">)</span>
    <span class="n">R</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">render_options</span><span class="p">)</span>
    
<span class="c1"># update vs setdata vs imshow vs... ?</span>
<span class="c1">#     plt.show()</span>
<span class="c1"># todo: simulate multiple tracks in parallel</span>
<span class="c1"># reuse existing results when changing resolution, colormap, etc.</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">dict</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">[</span><span class="s1">&#39;Resolution&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">v</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">R</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>6.0</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">R</span><span class="o">.</span><span class="n">cmaps</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;rainbow&#39;,
 &#39;hot&#39;,
 &#39;cool&#39;,
 &#39;autumn&#39;,
 &#39;winter&#39;,
 &#39;summer&#39;,
 &#39;Greys&#39;,
 &#39;Purples&#39;,
 &#39;Blues&#39;,
 &#39;Greens&#39;,
 &#39;Oranges&#39;,
 &#39;Reds&#39;,
 &#39;YlOrBr&#39;,
 &#39;YlOrRd&#39;,
 &#39;OrRd&#39;,
 &#39;PuRd&#39;,
 &#39;RdPu&#39;,
 &#39;BuPu&#39;,
 &#39;GnBu&#39;,
 &#39;PuBu&#39;,
 &#39;YlGnBu&#39;,
 &#39;PuBuGn&#39;,
 &#39;BuGn&#39;,
 &#39;YlGn&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span>
<span class="n">seed</span><span class="p">[</span><span class="n">seed</span><span class="o">.</span><span class="n">size</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span>
              <span class="nb">min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> 
              <span class="nb">max</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span> 
              <span class="n">step</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> 
              <span class="n">value</span> <span class="o">=</span> <span class="n">seed</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)}</span>

<span class="n">conv_settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s1">&#39;symm&#39;</span><span class="p">)</span>
<span class="nd">@interact</span><span class="p">(</span><span class="o">**</span><span class="n">kernel</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">convolve</span><span class="p">(</span><span class="o">**</span><span class="n">kernel</span><span class="p">):</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">kernel</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">convolve2d</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="c1"># convolve(kernel)</span>
    
<span class="c1"># iterated convolutions</span>
<span class="c1"># learning to produce dynamical system rules that fit some objective *</span>
<span class="c1"># approximate distribution of sample with smooth function?</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">R</span><span class="o">.</span><span class="n">canvas</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       ...,
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.]])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">theta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.01</span>
<span class="n">rMatrix</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span>
    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)]</span>
<span class="p">]</span>
<span class="n">rMatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rMatrix</span><span class="p">)</span>
<span class="c1"># rMatrix = np.array([rMatrix]*2).swapaxes(1,2)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rMatrix</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># ((X-h)[0] @ (rMatrix)[0])+h</span>

<span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">al2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span>
<span class="k">def</span> <span class="nf">W</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">rMatrix</span><span class="o">@</span><span class="p">(</span><span class="n">al2d</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">-</span><span class="n">al2d</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">+</span><span class="n">al2d</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1001</span><span class="p">):</span>
<span class="c1">#     X=(X-h)@rMatrix+h</span>
<span class="c1">#     Y=(rMatrix@(Y-X))+X</span>

    <span class="n">c</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">,</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">])</span>
    <span class="n">X_</span><span class="p">,</span> <span class="n">Y_</span><span class="p">,</span> <span class="n">Z_</span> <span class="o">=</span> <span class="n">c</span>
    <span class="n">X</span><span class="o">=</span><span class="n">W</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">h</span><span class="p">)</span>
    <span class="n">Y</span><span class="o">=</span><span class="n">W</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">X_</span><span class="p">)</span>
<span class="c1">#     Z=W(Z,Y_)</span>
    
    <span class="n">xs</span><span class="o">+=</span><span class="p">[</span><span class="n">X</span><span class="p">]</span>
    <span class="n">ys</span><span class="o">+=</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span>
<span class="c1">#     zs+=[Z]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
<span class="n">q</span><span class="o">=</span><span class="mi">2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1001</span><span class="p">)]</span><span class="o">*</span><span class="n">q</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">][:</span><span class="n">q</span><span class="p">])[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="c1"># print(Z)</span>
<span class="c1"># loop aggregators</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">isinstance</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># plt.plot(np.array(R.pivots_)[:,2,:].sum(axis=1))</span>
<span class="c1"># np.array(R.pivots_)[:5,1,0]</span>
<span class="c1"># R.points</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

